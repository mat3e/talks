<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Spring Security</title>

    <meta name="description"
          content="Serwery (Authorization i Resource), OAuth Client, SecurityFilterChain i ciut wiƒôcej ze Spring Security">
    <meta name="author" content="mat3e">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">

    <link rel="stylesheet" href="plugin/highlight/github.css">
    <link rel="stylesheet" href="plugin/fa/css/fontawesome.min.css">
    <link rel="stylesheet" href="plugin/fa/css/brands.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .reveal section img.pure-img {
            background: rgba(255, 255, 255, 0);
            border: none;
            box-shadow: none;
            margin: 0;
        }

        #perspective a {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            width: 45%;
            margin: 0 auto;
        }

        #perspective a img {
            border: 0;
            margin: 0;
            box-shadow: none;
        }

        #about-me {
            padding: 1em;
            background-color: rgba(255, 255, 255, .75);
            list-style-type: none;
            margin-left: 0;
            float: left;
        }

        #about-me ul {
            list-style-type: none;
            float: left;
            margin-left: 0;
            padding-left: 0;
        }

        #about-me a {
            color: #a23;
        }

        #about-me a:hover {
            color: #dd5566;
        }

        .reveal .slides section .fragment.highlight-red-reverse {
            color: #ff2c2d;
            opacity: 1;
            visibility: inherit;
            font-style: italic;
        }

        .reveal .slides section .fragment.visible.highlight-red-reverse {
            color: inherit;
            font-style: inherit;
        }

        .reveal .slides section .fragment.highlight-red {
            font-style: inherit;
        }

        .reveal .slides section .fragment.visible.highlight-red {
            font-style: italic;
        }
    </style>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-background-image>
            <section data-background-image="img/logo-security.svg"
                     data-background-size="contain">
                <div style="text-align:left;border-left: solid .1em white;line-height:.85;padding-left:.25em;">
                    <h1 style="text-shadow: #000 1px 0 10px;margin: 0; font-size: 1.9em">Serwery, OAuth Client,
                        <code>SecurityFilterChain</code>
                    </h1>
                    <h2 style="text-shadow: #000 1px 0 10px;font-size: 1.35em">i ciut wiƒôcej ze Spring Security</h2>
                </div>
                <div style="width: 320px; height: 64px; background-image: url('img/twitter.png'); background-size: contain; top: -4em; right: 0; position: absolute;"></div>
            </section>
            <section id="perspective" data-background-image>
                <h5>
                    <span>Perspektywa...</span>
                    <span class="fragment" data-fragment-index="1"> ma znaczenie</span>
                    <span class="fragment" data-fragment-index="2"> :)</span>
                </h5>
                <a href="https://mistrzowie.org/717022">
                    <img src="img/perspektywa-1.jpg">
                    <img src="img/perspektywa-2.jpg" class="fragment" data-fragment-index="1">
                    <img src="img/perspektywa-3.jpg" class="fragment" data-fragment-index="2">
                </a>
            </section>
            <section data-background-image="img/bg-hd.jpg">
                <ul id="about-me">
                    <li>
                        <ul>
                            <li>
                                <a href="https://www.linkedin.com/in/mateusz-chrzonstowski/">
                                    <i class="fa-brands fa-square-linkedin"
                                       style="color: #0077B5; background-color: #FFF; line-height: .75em"></i>
                                    /mateusz-chrzonstowski
                                </a>
                            </li>
                            <li>
                                <a href="https://x.com/_mat3e_">
                                    <i class="fa-brands fa-square-x-twitter"
                                       style="color: #000; line-height: .75em"></i>
                                    /_mat3e_
                                </a>
                            </li>
                            <li>
                                <a href="https://www.reddit.com/user/_mat3e_">
                                    <i class="fa-brands fa-square-reddit"
                                       style="color: #FF4500; line-height: .75em"></i>
                                    /_mat3e_
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/mat3e/">
                                    <i class="fa-brands fa-square-github"
                                       style="color: #24292E; background-color: #FFF; line-height: .75em"></i>
                                    /mat3e
                                </a>
                            </li>
                            <li style="line-height: 1">&nbsp;</li>
                            <li class="fragment" style="line-height: .75">
                                <a style="font-size: .75em; font-weight: bold;"
                                   href="https://mat3e.github.io/talks/spring-security/confitura.html">
                                    mat3e.github.io/talks/
                                    <div style="margin-left: 4.5em;margin-top: .25em">
                                        spring-security/confitura
                                    </div>
                                </a>
                            </li>
                            <li style="line-height: 1">&nbsp;</li>
                        </ul>
                    </li>
                    <li>
                        <ul class="fragment" style="padding: .1em; line-height: 1; text-align: center">
                            <li>
                                <a href="https://paramount.tech/careers-warsaw/">
                                    <img src="img/paramount.png" style="height: 2em; margin: 0">
                                </a>
                            </li>
                            <li>
                                <a href="https://full-stack.engineering/" class="fragment">
                                    <img src="img/udemy-new.svg" style="height: 1em; margin: 0">
                                </a>
                            </li>
                            <li>
                                <a href="https://polskietermopile.pl/projekty/400/" class="fragment">
                                    <img src="img/400 logo.png" style="height: 1em; margin: 0">
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>
        </section>
        <section data-background-image>
            <section data-auto-animate>
                <h1><code>Auth</code></h1>
                <table>
                    <tbody>
                    <tr>
                        <td data-id="n" style="width: 50%;text-align: center">
                            Authentication
                        </td>
                        <td data-id="z" style="width: 50%;text-align: center">
                            Authorization
                        </td>
                    </tr>
                    </tbody>
                </table>
            </section>
            <section data-auto-animate>
                <h1><code>Auth</code></h1>
                <small>
                    <em>
                        <a href="https://github.com/nurkiewicz/polski-w-it">github.com/nurkiewicz/polski-w-it</a>
                    </em>
                </small>
                <table>
                    <tbody>
                    <tr>
                        <td data-id="n" style="width: 50%;text-align: center">
                            Uwierzytelnianie
                        </td>
                        <td data-id="z" style="width: 50%;text-align: center">
                            Autoryzacja
                        </td>
                    </tr>
                    </tbody>
                </table>
                <aside class="notes">
                    Pytanie za gad≈ºety -> kr√≥tko czym AuthN, czym AuthZ
                </aside>
            </section>
        </section>
        <section data-background-image>
            <section>
                <img src="img/later-fix.png"/>
            </section>
            <section data-background-image="img/ihor.png" data-background-size="50%">
                <blockquote class="fragment"
                            style="font-size: .75em; text-align: left; width: 95%; background-color: rgba(0,0,0,.9)">
                    <div>
                        üìö Explore the full series:
                    </div>
                    <div>
                        1Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-1-introduction-c2709ff1bd98">Introduction</a>
                        üìù
                    </div>
                    <div>
                        2Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-2-simple-authentication-with-opaque-token-0417187f7e9e">Simple
                        authentication with Opaque token</a> üìù
                    </div>
                    <div>
                        3Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-3-simple-authentication-with-jwt-token-42c23a1c375d">Simple
                        authentication with JWT token</a> üìù
                    </div>
                    <div>
                        4Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-4-out-of-the-box-implementations-http-basic-with-userdetailsservice-9ec3360c66ed">Out-of-the-box
                        implementations ‚Äî HTTP Basic with UserDetailsService</a> üìù
                    </div>
                    <div>
                        5Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-5-out-of-the-box-implementations-form-login-f538197b7b17">Out-of-the-box
                        implementations ‚Äî Form login</a> üìù
                    </div>
                    <div>
                        6Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-6-custom-implementation-of-jwt-api-key-authentication-5c22a6791f3c">Custom
                        implementation of JWT + API Key authentication</a> üìù
                    </div>
                    <div>
                        7Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-7-custom-jwt-api-key-auth-with-configurers-e984cbe40160">Custom
                        JWT + API Key auth with Configurers</a> üìù
                    </div>
                    <div>
                        8Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-8-authenticationfilter-based-implementation-of-jwt-api-key-auth-ed42ed24f5a9">AuthenticationFilter-based
                        implementation of JWT + API
                        Key auth</a> üìù
                    </div>
                    <div>
                        9Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-9-authenticationfilter-based-jwt-api-key-auth-with-configurers-fb91309558d0">AuthenticationFilter-based
                        JWT + API Key auth with
                        Configurers</a> üìù
                    </div>
                    <div>
                        üîü <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-10-oauth-client-implementation-1ffdd23d25d3">OAuth
                        client implementation</a> üìù
                    </div>
                    <div>
                        1Ô∏è‚É£1Ô∏è‚É£ <a
                            href="https://medium.com/@ihor.polataiko/spring-security-guide-part-11-combining-different-authentication-mechanisms-fbb288df7433">Combining
                        different authentication mechanisms</a> üìù
                    </div>
                </blockquote>
            </section>
            <section>
                <a href="https://www.youtube.com/watch?v=3spgz1LXcS8">
                    <img src="img/laur-spicla.png" style="width: 70%">
                    <br/>
                    <small>Deep diving in Spring Security with the latest trends and additions By Laur Spilca</small>
                </a>
            </section>
        </section>
        <section data-background-image>
            <section>
                <h2><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13">OAuth 2.1</a></h2>
                <pre>
+--------+                               +---------------+
|        |<span class="fragment" data-fragment-index="5">--(1)- Authorization Request -></span>|   <span
                        class="fragment fade-out replace" data-fragment-index="2">Resource</span><span
                        class="fragment fade-in replace" data-fragment-index="2">        </span>    |
|        |                               |   <span class="fragment fade-out replace"
                                                   data-fragment-index="2">  Owner   </span><span
                        class="fragment fade-in replace" data-fragment-index="2">u≈ºytkownik</span>  |
|        |<span class="fragment" data-fragment-index="6"><-(2)-- Authorization Grant ---</span>|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |<span class="fragment" data-fragment-index="7">--(3)-- Authorization Grant --></span>| <span
                        class="fragment fade-out replace" data-fragment-index="3">Authorization</span><span
                        class="fragment fade-in replace" data-fragment-index="3">             </span> |
|<span class="fragment fade-out replace" data-fragment-index="1"> Client </span><span class="fragment fade-in replace"
                                                                                      data-fragment-index="1">frontend</span>|                               |     <span
                        class="fragment fade-out replace" data-fragment-index="3">Server</span><span
                        class="fragment fade-in replace" data-fragment-index="3"> Okta </span>    |
|        |<span class="fragment" data-fragment-index="8"><-(4)----- Access Token -------</span>|               |
|        |                               +---------------+
|        |
|        |                               <span class="fragment highlight-red"
                                               data-fragment-index="11">+---------------+</span>
|        |<span class="fragment" data-fragment-index="9">--(5)----- Access Token ------></span><span
                        class="fragment highlight-red" data-fragment-index="11">|    <span
                        class="fragment fade-out replace" data-fragment-index="4">Resource</span><span
                        class="fragment fade-in replace" data-fragment-index="4">        </span>   |</span>
|        |                               <span class="fragment highlight-red" data-fragment-index="11">|    <span
                        class="fragment fade-out replace" data-fragment-index="4"> Server</span><span
                        class="fragment fade-in replace" data-fragment-index="4">backend</span>    |</span>
|        |<span class="fragment" data-fragment-index="10"><-(6)--- Protected Resource ---</span><span
                        class="fragment highlight-red" data-fragment-index="11">|               |</span>
+--------+                               <span class="fragment highlight-red"
                                               data-fragment-index="11">+---------------+</span>
                </pre>
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security
                        Arch</a>
                </h2>
                <img data-id="sfc" src="img/sfc/1.png" style="filter: invert(1)">
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html#servlet-delegatingfilterproxy">Spring
                        Security
                        Arch</a>
                </h2>
                <img data-id="sfc" src="img/sfc/2.png" style="filter: invert(1)">
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html#servlet-filterchainproxy">Spring
                        Security
                        Arch</a>
                </h2>
                <img data-id="sfc" src="img/sfc/2.png"
                     style="filter: invert(1); position: absolute;  left: 16%; opacity: 0">
                <img data-id="sfc2" src="img/sfc/3.png" style="filter: invert(1)">
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html#servlet-securityfilterchain">Spring
                        Security
                        Arch</a>
                </h2>
                <img data-id="sfc2" src="img/sfc/4.png" style="filter: invert(1)">
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html#servlet-securityfilterchain">Spring
                        Security
                        Arch</a>
                </h2>
                <img data-id="sfc2" src="img/sfc/5.png" style="filter: invert(1)">
                <img data-id="sfc3" src="img/sfc/6.png"
                     style="filter: invert(1);position: absolute;right: 3%;top:25%;width: 30%;opacity: 0">
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html#servlet-exceptiontranslationfilter">Spring
                        Security
                        Arch</a>
                </h2>
                <img data-id="sfc2" src="img/sfc/5.png" style="filter: invert(1);position: absolute; opacity: 0">
                <img data-id="sfc3" src="img/sfc/6.png" style="filter: invert(1); width: 65%">
                <pre class="fade-in-then-out fragment"
                     style="position: absolute;top:20%;width: 100%;margin: 0 auto"><code class="java fragment fade-out"
                                                                                         style="font-size: .75em"
                                                                                         data-trim
                                                                                         data-line-numbers="17-19">
                @Bean
                @Order(0)
                SecurityFilterChain oidcProtocolEndpointsChain(
                  HttpSecurity http,
                  UserDetailsService userDetailsService,
                  PasswordEncoder passwordEncoder,
                  OAuth2AuthorizationService authorizationService,
                  OAuth2TokenGenerator&lt;? extends OAuth2Token> tokenGenerator
                ) throws Exception {
                  OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
                  http
                    .getConfigurer(OAuth2AuthorizationServerConfigurer.class)
                    .oidc(withDefaults())
                    .tokenEndpoint(tokenEndpoint -> tokenEndpoint
                      .accessTokenRequestConverter(new OAuth2PasswordGrantAuthenticationConverter())
                      .authenticationProvider(new OAuth2PasswordGrantAuthenticationProvider(userDetailsService, passwordEncoder, authorizationService, tokenGenerator)));
                  return http.exceptionHandling(exceptions -> exceptions.authenticationEntryPoint(
                     new LoginUrlAuthenticationEntryPoint("/oauth2/authorization/okta"))
                  ).build();
                }
                </code></pre>
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/index.html">
                        Resource Server
                    </a>
                </h2>
                <img data-id="sfc3" src="img/sfc/20.png" style="filter: invert(1); width: 85%">
            </section>
            <section data-auto-animate>
                <a href="https://x.com/engineers_feed/status/1859549918387429856">
                    <img src="img/modularity/1.png" style="width: 45%" data-id="modularity">
                </a>
            </section>
            <section data-auto-animate>
                <a href="https://x.com/raimeyuu/status/1859976330160251173">
                    <img src="img/modularity/2.png" style="width: 50%" data-id="modularity">
                </a>
            </section>
            <section data-auto-animate>
                <a href="https://x.com/tomasz_ducin/status/1860240988184223783">
                    <img src="img/modularity/3.png" style="width: 60%" data-id="modularity2">
                </a>
                <img src="img/modularity/2.png" style="width: 45%; position: absolute; right: 23%; top:15%;opacity: 0"
                     data-id="modularity">
            </section>
            <section data-auto-animate>
                <h2 style="margin: 0"><code>Configurer</code>, <code>Customizer</code></h2>
                <a href="https://x.com/tomasz_ducin/status/1860240988184223783">
                    <img src="img/modularity/3.png" style="width: 50%" data-id="modularity2">
                </a>
                <pre style="width: 100%;position: absolute;top:10%;" class="fragment"><code class="java r-stretch"
                                                                                            style="font-size: .9em"
                                                                                            data-trim
                                                                                            data-line-numbers="1,3-15|5,13|11-12|9-10|8">
                    @Bean
                    @Order(2)
                    SecurityFilterChain oauthChain(
                        HttpSecurity http,
                        Customizer&lt;AuthorizeHttpRequestsConfigurer&lt;HttpSecurity>.AuthorizationManagerRequestMatcherRegistry> permissionsCustomizer
                    ) throws Exception {
                      return http
                          .oauth2ResourceServer(oauth2 -> oauth2.jwt(withDefaults()))
                          .csrf(AbstractHttpConfigurer::disable)
                          .cors(AbstractHttpConfigurer::disable)
                          .sessionManagement(session ->
                            session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                          .authorizeHttpRequests(permissionsCustomizer)
                          .build();
                    }
                </code></pre>
                <aside class="notes">configurer = init (shared objects) + configure</aside>
            </section>
        </section>
        <section data-background-image>
            <section>
                <h2><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13">OAuth 2.1</a></h2>
                <pre>
+--------+                               +---------------+
|        |--(1)- Authorization Request ->|               |
|        |                               |   u≈ºytkownik  |
|        |<-(2)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               <span class="fragment highlight-red"
                                               data-fragment-index="1">+---------------+</span>
|        |--(3)-- Authorization Grant --><span class="fragment highlight-red"
                                               data-fragment-index="1">|               |</span>
|frontend|                               <span class="fragment highlight-red"
                                               data-fragment-index="1">|      Okta     |</span>
|        |<-(4)----- Access Token -------<span class="fragment highlight-red"
                                               data-fragment-index="1">|               |</span>
|        |                               <span class="fragment highlight-red"
                                               data-fragment-index="1">+---------------+</span>
|        |
|        |<span class="fragment highlight-red"
                data-fragment-index="1">                               </span><em style="color: #ff2c2d;">+---------------+</em>
|        |<span class="fragment highlight-red"
                data-fragment-index="1">--(5)----- Access Token ------></span><em style="color: #ff2c2d;">|               |</em>
|        |<span class="fragment highlight-red"
                data-fragment-index="1">                               </span><em style="color: #ff2c2d;">|    backend    |</em>
|        |<span class="fragment highlight-red"
                data-fragment-index="1"><-(6)--- Protected Resource ---</span><em style="color: #ff2c2d;">|               |</em>
+--------+<span class="fragment highlight-red"
                data-fragment-index="1">                               </span><em style="color: #ff2c2d;">+---------------+</em>
                </pre>
            </section>
            <section data-auto-animate>
                <pre data-id="os-m"><code class="xml" data-trim data-line-numbers>
                    &lt;dependency>
                        &lt;groupId>com.okta.spring&lt;/groupId>
                        &lt;artifactId>okta-spring-boot-starter&lt;/artifactId>
                    &lt;/dependency>
                </code></pre>
                <div class="fragment" data-id="okta-changes">
                    <code>Okta Developer Edition</code> <em class="fragment">(forever-free)</em>
                    <span class="fragment"> ‚áí&nbsp;<code>Integrator Free Plan</code></span>
                </div>
                <aside class="notes">
                    Okta zmieni≈Ça z "forever-free" dev account na integrator free, wysy≈Ça teraz spam sprzeda≈ºowy, "hej
                    jak pom√≥c". "forever" = do maja 2025. A Spring to wywali≈Ç z Initializra
                </aside>
            </section>
            <section data-auto-animate>
                <pre data-id="os-m"><code class="xml" data-trim data-line-numbers="4">
                    &lt;dependency>
                        &lt;groupId>com.okta.spring&lt;/groupId>
                        &lt;artifactId>okta-spring-boot-starter&lt;/artifactId>
                        &lt;version>${okta.springboot.version}&lt;/version>
                    &lt;/dependency>
                </code></pre>
                <div data-id="okta-changes">
                    <code>Okta Developer Edition</code> <em>(forever-free)</em>
                    <span> ‚áí&nbsp;<code>Integrator Free Plan</code></span>
                </div>
                <pre class="fragment"
                     style="position: absolute; top: 35%; width: 100%;transform: rotate(-15deg)"><code data-trim
                                                                                                       style="width: 100%;font-size: .55em;overflow-x: hidden; line-height: 1.1">
                    org.springframework.security.oauth2.server.resource.InvalidBearerTokenException:
                        An error occurred while attempting to decode the Jwt: JOSE header typ (type) application/okta-internal-at+jwt not allowed
                </code></pre>
                <aside class="notes">pytanie za Spoinƒô -> o co cho z tym b≈Çƒôdem?</aside>
            </section>
            <section>
                <img src="img/logs.png" style="width: 45%"/>
            </section>
            <section data-auto-animate>
                <a href="https://devforum.okta.com/t/okta-access-token-type-is-not-jwt/29515/2">
                    <img src="img/okta-forum.png" data-id="okta-forum">
                </a>
            </section>
            <section data-auto-animate>
                <a href="https://devforum.okta.com/t/okta-access-token-type-is-not-jwt/29515/2">
                    <img src="img/okta-forum2.png" data-id="okta-forum">
                    Forum
                </a>
            </section>
            <section>
                <blockquote style="text-align: left; font-size: .5em">
                    <h2>Org authorization server</h2>
                    <div>
                        Every Okta org comes equipped with a built-in org authorization server. The org authorization
                        server issues access tokens for accessing Okta resources in your Okta org domain. <span
                            class="fragment highlight-red" data-fragment-index="1">Use the org</span>
                        authorization <span class="fragment highlight-red" data-fragment-index="1">server</span> to
                        perform Single Sign-On (SSO) with Okta for your OIDC apps or <span
                            class="fragment highlight-red" data-fragment-index="1">to get an
                        access token to access Okta APIs</span>.
                    </div>
                    <blockquote style="width: 90%" class="fragment highlight-red" data-fragment-index="1">
                        <strong>Note</strong>: In the org authorization server, Okta is the resource server.
                    </blockquote>
                    <p>(...)</p>
                    <h2 class="fragment highlight-green">Custom authorization server</h2>
                    <p>(...)</p>
                    <h3>Default custom authorization server</h3>
                    <div>(...)</div>
                </blockquote>
                <a href="https://developer.okta.com/docs/concepts/auth-servers/#available-authorization-server-types">Okta
                    docs</a>
            </section>
            <section data-auto-animate data-auto-animate-id="fix">
                <pre data-id="okta-server" style="width: 100%"><code data-trim style="font-size: .8em">
                    https://{yourOktaDomain}.okta.com/.well-known/openid-configuration
                </code></pre>
            </section>
            <section data-auto-animate data-auto-animate-id="fix">
                <pre data-id="okta-server" style="width: 100%"><code data-trim style="font-size: .8em">
                    https://{yourOktaDomain}.okta.com/oauth2/default/.well-known/openid-configuration
                </code></pre>
            </section>
        </section>
        <section data-background-image>
            <section>
                <h2><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13">OAuth 2.1</a></h2>
                <pre>
+--------+                               +---------------+
|        |--(1)- Authorization Request ->|               |
|        |                               |   u≈ºytkownik  |
|        |<-(2)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               <span class="fragment highlight-red-reverse"
                                               data-fragment-index="1">+---------------+</span>
|        |--(3)-- Authorization Grant --><span class="fragment highlight-red-reverse"
                                               data-fragment-index="1">|               |</span>
|frontend|                               <span class="fragment highlight-red-reverse"
                                               data-fragment-index="1">|      Okta     |</span>
|        |<span class="fragment highlight-red" data-fragment-index="1"><-(4)----- Access Token -------</span><span
                        class="fragment highlight-red-reverse"
                        data-fragment-index="1">|               |</span>
|        |                               <span class="fragment highlight-red-reverse"
                                               data-fragment-index="1">+---------------+</span>
|        |
|        |<span class="fragment highlight-red-reverse"
                data-fragment-index="1">                               +---------------+</span>
|        |<em style="color: #ff2c2d;">--(5)----- Access Token ------></em><span
                        class="fragment highlight-red-reverse"
                        data-fragment-index="1">|               |</span>
|        |<span class="fragment highlight-red-reverse"
                data-fragment-index="1">                               |    backend    |</span>
|        |<span class="fragment highlight-red-reverse"
                data-fragment-index="1"><-(6)--- Protected Resource ---|               |</span>
+--------+<span class="fragment highlight-red-reverse"
                data-fragment-index="1">                               +---------------+</span>
                </pre>
            </section>
            <section>
                <h2 style="margin: 0">Grupy AD?</h2>
                <ul>
                    <li class="fragment" data-fragment-index="1">Ma≈Ço elastyczne w du≈ºej organizacji</li>
                    <li class="fragment" data-fragment-index="2">Wiƒôkszy <em>self-service</em> dla kierownik√≥w zespo≈Ç√≥w
                    </li>
                </ul>
                <hr class="fragment" data-fragment-index="3"/>
                <h2 style="margin: 0" class="fragment" data-fragment-index="3">JWT <code>scope</code>?</h2>
                <ul>
                    <li class="fragment">Klient deklaruje o jakie <code>scope</code> pyta
                        (opcjonalnie)
                        <ul>
                            <li class="fragment">Brak? Domy≈õlny (ma≈Çy) zakres (PoLP)</li>
                            <li class="fragment">Klient, nie u≈ºytkownik</li>
                        </ul>
                    </li>
                    <li class="fragment">
                        <code>scope</code> = co wolno z tym tokenem (gruboziarniste)
                    </li>
                </ul>
                <aside class="notes">
                    principle of least privilege (PoLP) - pytanie konkursowe?
                </aside>
                <img src="img/scope.png" style="width: 40%;position: absolute;top:10%;left: 30%" class="fragment"/>
            </section>
            <section>
                <h3>PoC uprawnie≈Ñ - 1/2</h3>
                <ul>
                    <li class="fragment">100-200 ju≈º istniejƒÖcych endpoint√≥w</li>
                    <li class="fragment">Powtarzalne, ~konwencja
                        <ul>
                            <li class="fragment">GET /collection/{id}</li>
                            <li class="fragment">POST /asset</li>
                            <li class="fragment">PATCH /promotion/{id}/publication</li>
                        </ul>
                    </li>
                    <li class="fragment">Domy≈õlnie zabezpieczyƒá</li>
                    <li class="fragment">≈Åatwo≈õƒá definiowania nowych uprawnie≈Ñ</li>
                </ul>
                <aside class="notes">Domy≈õlnie zabezpieczone - trzeba podaƒá propsy, bo inaczej <code>denyAll</code>
                </aside>
            </section>
            <section>
                <h3>PoC uprawnie≈Ñ - 2/2</h3>
                <pre><code class="yaml" data-trim style="font-size: .65em; line-height:1.1"
                           data-line-numbers="1-3">
                    admin.permissions:
                      resources: asset, promotion, collection
                      operations: view, modify, publish
                      metapermissions: role.delete, role.modify, role.view
                </code></pre>
                <pre style="margin-top: 0; margin-bottom: 0" class="fragment"><code class="java" data-trim
                                                                                    style="font-size: .7em; line-height:1.1"
                                                                                    data-line-numbers="1-6,8-9,13-14">
                    @ConfigurationProperties("admin.permissions")
                    class Permissions {
                      void authorize(HttpSecurity http) {
                        resources.forEach(resource -> operations.forEach(operation ->
                            () -> http.authorizeHttpRequests(operation.on(resource))));
                      }

                      enum Operations {
                        view(GET), modify(POST, PATCH, PUT), publish("/publication/**", PATCH);

                        Customizer&lt;AuthorizeHttpRequestsConfigurer&lt;HttpSecurity>.AuthorizationManagerRequestMatcherRegistry> on(String resource) {
                          return authorize -> matchingMethods.forEach(httpMethod ->
                            authorize.requestMatchers(httpMethod, resource + "/**" + additionalPath)
                              .access(hasAuthority(resource + "." + name())));
                        }

                        private final Set&lt;HttpMethod> matchingMethods;
                        private final String additionalPath;
                      }
                    }
                </code></pre>
                <aside class="notes">
                    A klienty? Service Account
                </aside>
            </section>
            <section>
                <h3><code>application-security.yaml</code> (protip)</h3>
                <ul>
                    <li class="fragment">Wszystko zwiƒÖzane z zabezpieczeniami od razu tam</li>
                    <li class="fragment">Profil=≈õrodowisko? Niekoniecznie (~zmienne ≈õrodowiskowe)
                        <ul>
                            <li class="fragment">Profile grupujƒÖce podobne w≈Ça≈õciwo≈õci</li>
                            <li class="fragment">Uruchamianie wielu jednocze≈õnie</li>
                        </ul>
                    </li>
                    <li class="fragment">≈Åatwo lokalnie (kompatybilno≈õƒá wsteczna)</li>
                </ul>
            </section>
            <section>
                <pre style="width: 100%"><code class="java r-stretch" data-trim data-line-numbers>
                    @Configuration(proxyBeanMethods = false)
                    class SecurityConfiguration {
                      @Profile({"!security"})
                      @Bean
                      SecurityFilterChain noAuthenticationFilterChain(HttpSecurity http) throws Exception {
                        return http
                          .csrf(AbstractHttpConfigurer::disable)
                          .cors(AbstractHttpConfigurer::disable);
                          .authorizeHttpRequests((request) ->
                              request.anyRequest().permitAll());
                          .build();
                      }

                      @Profile({"security"})
                      @Configuration(proxyBeanMethods = false)
                      @EnableConfigurationProperties(BasicAuthSettings.class)
                      static class SecurityTurnedOn {
                        // all other filter chains here
                      }
                    }
                </code></pre>
            </section>
        </section>
        <section data-background-image>
            <section>
                <h2><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13">OAuth 2.1</a></h2>
                <pre>
+--------+                               +---------------+
|        |--(1)- Authorization Request ->|               |
|        |                               |   u≈ºytkownik  |
|        |<-(2)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               <span class="fragment highlight-red"
                                               data-fragment-index="1">+---------------+</span>
|        |--(3)-- Authorization Grant --><span class="fragment highlight-red"
                                               data-fragment-index="1">|               |</span>
|frontend|                               <span class="fragment highlight-red" data-fragment-index="1">|    <span
                        class="fragment fade-out replace" data-fragment-index="1">  Okta </span><span
                        class="fragment fade-in replace" data-fragment-index="1"><span class="fragment fade-out replace"
                                                                                       data-fragment-index="2">backend</span><span
                        class="fragment fade-in replace" data-fragment-index="2">       </span></span>    |</span>
|        |<em style="color: #ff2c2d"><-(4)----- Access Token -------</em><span class="fragment highlight-red"
                                                                               data-fragment-index="1">|               |</span>
|        |                               <span class="fragment highlight-red"
                                               data-fragment-index="1"><span class="fragment fade-out replace"
                                                                             data-fragment-index="2">+---------------+</span><span
                        class="fragment fade-in replace" data-fragment-index="2">+               +</span></span>
|        |                               <em class="fragment" style="color: #ff2c2d" data-fragment-index="2">|    backend    |</em>
|        |                               <span class="fragment fade-out replace" data-fragment-index="2">+---------------+</span><em
                        class="fragment fade-in replace" data-fragment-index="2"
                        style="color:#ff2c2d">+               +</em>
|        |<em style="color: #ff2c2d">--(5)----- Access Token ------></em><span class="fragment highlight-red"
                                                                               data-fragment-index="2">|               |</span>
|        |                               <span class="fragment highlight-red" data-fragment-index="2">|    <span
                        class="fragment fade-out replace" data-fragment-index="2">backend</span><span
                        class="fragment fade-in replace" data-fragment-index="2">       </span>    |</span>
|        |<-(6)--- Protected Resource ---<span class="fragment highlight-red"
                                               data-fragment-index="2">|               |</span>
+--------+                               <span class="fragment highlight-red"
                                               data-fragment-index="2">+---------------+</span>
                </pre>
            </section>
            <section data-auto-animate>
                <h2 data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html#servlet-securityfilterchain">Spring
                        Security
                        Arch</a>
                </h2>
                <img data-id="sfc2" src="img/sfc/5.png" style="filter: invert(1)">
                <img data-id="sfc3" src="img/sfc/7.png"
                     style="filter: invert(1);position: absolute;right: 3%;top:25%;width: 30%;opacity: 0">
            </section>
            <section data-auto-animate>
                <h2 style="margin: 0" data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security
                        Arch</a>
                </h2>
                <img data-id="sfc2" src="img/sfc/5.png"
                     style="filter: invert(1);position: absolute;left: 15%; opacity: 0">
                <img data-id="sfc3" src="img/sfc/7.png" style="filter: invert(1); width: 65%">
            </section>
            <section data-auto-animate>
                <h2 style="margin: 0" data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security
                        Arch</a>
                </h2>
                <img data-id="sfc4" src="img/sfc/8.png" style="filter: invert(1); width: 67%">
                <pre class="fade-in-then-out fragment"
                     style="position: absolute;top:15%;width:100%"><code class="java fragment fade-out"
                                                                         data-trim>
                    // DisabledException, LockedException, BadCredentialsException
                    public interface AuthenticationManager {
                        Authentication authenticate(Authentication authentication)
                            throws AuthenticationException;
                    }
                </code></pre>
            </section>
            <section data-auto-animate>
                <h2 style="margin: 0" data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security
                        Arch</a>
                </h2>
                <img data-id="sfc4" src="img/sfc/9.png" style="filter: invert(1); width: 67%">
                <pre class="fragment" style="position: absolute;top:15%;width: 100%;"><code class="java"
                                                                                            style="font-size: .75em"
                                                                                            data-trim
                                                                                            data-line-numbers="11,14,16|5">
                @Bean
                @Order(0)
                SecurityFilterChain oidcProtocolEndpointsChain(
                  HttpSecurity http,
                  UserDetailsService userDetailsService,
                  PasswordEncoder passwordEncoder,
                  OAuth2AuthorizationService authorizationService,
                  OAuth2TokenGenerator&lt;? extends OAuth2Token> tokenGenerator
                ) throws Exception {
                  OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
                  http
                    .getConfigurer(OAuth2AuthorizationServerConfigurer.class)
                    .oidc(withDefaults())
                    .tokenEndpoint(tokenEndpoint -> tokenEndpoint
                      .accessTokenRequestConverter(new OAuth2PasswordGrantAuthenticationConverter())
                      .authenticationProvider(new OAuth2PasswordGrantAuthenticationProvider(userDetailsService, passwordEncoder, authorizationService, tokenGenerator)));
                  return http.exceptionHandling(exceptions -> exceptions.authenticationEntryPoint(
                     new LoginUrlAuthenticationEntryPoint("/oauth2/authorization/okta"))
                  ).build();
                }
                </code></pre>
            </section>
            <section data-auto-animate data-transition="fade-out">
                <h2 style="margin: 0" data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security
                        Arch</a>
                </h2>
                <img data-id="sfc4" src="img/sfc/10.png" style="filter: invert(1); width: 67%">
                <pre class="fade-in-then-out fragment"
                     style="position: absolute;top:30%;width:80%;left: 10%"><code class="java fragment fade-out"
                                                                                  data-trim>
                    /**
                     * ...
                     * @throws UsernameNotFoundException if the user
                     * could not be found or the user has no
                     * GrantedAuthority
                     */
                    public interface UserDetailsService {
                        UserDetails loadUserByUsername(String username)
                            throws UsernameNotFoundException;
                    }
                </code></pre>
            </section>
            <section data-transition="fade-in">
                <h2 style="margin: 0" data-id="sfc-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security
                        Arch</a>
                </h2>
                <img data-id="sfc6" src="img/sfc/11.png" style="filter: invert(1); width: 67%">
            </section>
        </section>
        <section data-background-image>
            <section>
                <h2><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13">OAuth 2.1</a></h2>
                <pre>
+--------+                               +---------------+
|        |--(1)- Authorization Request ->|               |
|        |                               |   u≈ºytkownik  |
|        |<span class="fragment highlight-red" data-fragment-index="1"><-(2)-- Authorization Grant ---</span>|               |
|        |                               +---------------+
|        |
|        |                               <em style="color: #ff2c2d">+---------------+</em>
|        |<span class="fragment highlight-red" data-fragment-index="1">--(3)-- Authorization Grant --></span><em
                        style="color: #ff2c2d">|               |</em>
|frontend|                               <em style="color: #ff2c2d">|               |</em>
|        |<em style="color: #ff2c2d"><-(4)----- Access Token -------|               |</em>
|        |                               <em style="color: #ff2c2d">+               +</em>
|        |                               <em style="color: #ff2c2d">|    backend    |</em>
|        |                               <em style="color: #ff2c2d">+               +</em>
|        |<em style="color: #ff2c2d">--(5)----- Access Token ------>|               |</em>
|        |                               <em style="color: #ff2c2d">|               |</em>
|        |<-(6)--- Protected Resource ---<em style="color: #ff2c2d">|               |</em>
+--------+                               <em style="color: #ff2c2d">+---------------+</em>
                </pre>
            </section>
            <section>
                <h4 style="margin: 0">
                    <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-13#name-authorization-code-grant">
                        Authorization Code Flow
                    </a>
                </h4>
                <div style="font-size: .75em; line-height: 1.1">
                <pre style="width: 71%;overflow: hidden; margin-bottom: 0" data-trim>
+----------+
| Resource |
|   Owner  |
+----------+
      <span class="fragment" data-fragment-index="2">^</span>
      <span class="fragment" data-fragment-index="2">|</span>
      <span class="fragment" data-fragment-index="2">|</span>
<span class="fragment" data-fragment-index="1">+-----<span class="fragment fade-out replace"
                                                           data-fragment-index="2">-</span><span
        class="fragment fade-in replace" data-fragment-index="2">|</span>----+</span>          <span class="fragment"
                                                                                                     data-fragment-index="1">Client Identifier</span>      +---------------+
<span class="fragment" data-fragment-index="1">| .---+---------(1)-- & Redirect URI -------></span>|               |
<span class="fragment" data-fragment-index="1">| |</span>   <span class="fragment"
                                                                  data-fragment-index="2">|</span>    <span
                        class="fragment" data-fragment-index="1">|</span>                                 |               |
<span class="fragment" data-fragment-index="1">| |</span>   <span class="fragment"
                                                                  data-fragment-index="2">'----</span><span
                        class="fragment" data-fragment-index="1"><span class="fragment fade-out replace"
                                                                       data-fragment-index="2">|</span><span
                        class="fragment fade-in replace" data-fragment-index="2">-</span></span><span class="fragment"
                                                                                                      data-fragment-index="2">----(2)-- User authenticates ---></span>|               |
<span class="fragment" data-fragment-index="1">| | User-  |</span>                                 | Authorization |
<span class="fragment" data-fragment-index="1">| | Agent  |</span>                                 |     Server    |
<span class="fragment" data-fragment-index="1">| |        |</span>                                 |               |
<span class="fragment" data-fragment-index="1">|</span> <span class="fragment" data-fragment-index="1">|</span>    <span
                        class="fragment" data-fragment-index="3">.---</span><span class="fragment"
                                                                                  data-fragment-index="1"><span
                        class="fragment fade-out replace" data-fragment-index="3">|</span><span
                        class="fragment fade-in replace" data-fragment-index="3">-</span></span><span class="fragment"
                                                                                                      data-fragment-index="3">----(3)-- Authorization Code ---<</span>|               |
<span class="fragment" data-fragment-index="1">+-|----<span class="fragment fade-out replace"
                                                            data-fragment-index="3">-</span><span
        class="fragment fade-in replace" data-fragment-index="3">|</span>---+</span>                                 +---------------+
  <span class="fragment" data-fragment-index="1">|</span>    <span class="fragment" data-fragment-index="3">|</span>                                         <span
                        class="fragment" data-fragment-index="4">^</span>      <span class="fragment"
                                                                                     data-fragment-index="5">v</span>
  <span class="fragment" data-fragment-index="1">|</span>    <span class="fragment" data-fragment-index="3">|</span>                                         <span
                        class="fragment" data-fragment-index="4">|</span>      <span class="fragment"
                                                                                     data-fragment-index="5">|</span>
  <span class="fragment" data-fragment-index="1">^</span>    <span class="fragment" data-fragment-index="3">v</span>                                         <span
                        class="fragment" data-fragment-index="4">|</span>      <span class="fragment"
                                                                                     data-fragment-index="5">|</span>
+---------+                                      <span class="fragment" data-fragment-index="4">|</span>      <span
                        class="fragment" data-fragment-index="5">|</span>
|         |<span class="fragment" data-fragment-index="4">>---(4)-- Authorization Code ---------'</span>      <span
                        class="fragment" data-fragment-index="5">|</span>
|  Client |          <span class="fragment" data-fragment-index="4">& Redirect URI</span>                     <span
                        class="fragment" data-fragment-index="5">|</span>
|         |                                             <span class="fragment" data-fragment-index="5">|</span>
|         |<span class="fragment" data-fragment-index="5"><---(5)----- Access Token -------------------'</span>
+---------+       <span class="fragment" data-fragment-index="5">(w/ Optional Refresh Token)</span>
                </pre>
                </div>
                <blockquote style="text-align: left;margin-top:.1em">
                    <ul style="font-size: .5em; margin-top: 0; margin-bottom: 0; line-height: 1.1">
                        <li class="fragment" data-fragment-index="1">[przekierowanie] PKCE (code challenge)</li>
                        <li class="fragment" data-fragment-index="3">[przekierowanie] Jednorazowy kod</li>
                        <li class="fragment" data-fragment-index="4">PKCE (code verifier)</li>
                    </ul>
                </blockquote>
                <aside class="notes">
                    authorization code ≈ºeby dostaƒá access token. Czemu nie od razu access token? Tak by≈Ço w implicit
                    grant, ale ju≈º nie ma. 1 i 3 to przekierowania i tak bezpieczniej - nawet jak siƒô podrƒÖbie
                    przekierowanie, to auth code jest jednorazowy i trzeba dodatkowo przekazaƒá info o kliencie w 4

                    <br/>
                    PKCE (Proof-Key for Code Exchange) - random value + hash for random value
                </aside>
            </section>
            <section data-background-image data-auto-animate>
                <div data-id="ssas">
                    <a href="https://docs.spring.io/spring-authorization-server/reference/overview.html">
                        Spring Security Authorization Server (kod)
                    </a>
                </div>
                <pre data-id="auth-s" style="width: 100%" class="r-stretch"><code class="java" style="font-size: .75em"
                                                                                  data-trim
                                                                                  data-line-numbers="1-4,9-13,17-20|22-30">
                @Bean
                @Order(0)
                SecurityFilterChain oidcProtocolEndpointsChain(
                  HttpSecurity http,
                  UserDetailsService userDetailsService,
                  PasswordEncoder passwordEncoder,
                  OAuth2AuthorizationService authorizationService,
                  OAuth2TokenGenerator&lt;? extends OAuth2Token> tokenGenerator
                ) throws Exception {
                  OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
                  http
                    .getConfigurer(OAuth2AuthorizationServerConfigurer.class)
                    .oidc(withDefaults())
                    .tokenEndpoint(tokenEndpoint -> tokenEndpoint
                      .accessTokenRequestConverter(new OAuth2PasswordGrantAuthenticationConverter())
                      .authenticationProvider(new OAuth2PasswordGrantAuthenticationProvider(userDetailsService, passwordEncoder, authorizationService, tokenGenerator)));
                  return http.exceptionHandling(exceptions -> exceptions.authenticationEntryPoint(
                     new LoginUrlAuthenticationEntryPoint("/oauth2/authorization/okta"))
                  ).build();
                }

                @Bean
                @Order(1)
                SecurityFilterChain oktaLoginChain(HttpSecurity http, UserService userService) throws Exception {
                  return http
                      .securityMatcher(anyOf(antMatcher("/oauth2/**"), antMatcher("/login/oauth2/**")))
                      .authorizeHttpRequests(authorize -> authorize.anyRequest().authenticated())
                      .oauth2Login(oauth2Login -> oauth2Login.successHandler(new CreateUserHandler(userService, requestCache)))
                      .build();
                }
                </code></pre>
            </section>
            <section data-auto-animate>
                <div data-id="ssas">
                    <a href="https://docs.spring.io/spring-authorization-server/reference/overview.html">
                        Spring Security Authorization Server (YAML)
                    </a>
                </div>
                <pre data-id="auth-s" style="width: 100%"><code class="yaml r-stretch"
                                                                style="font-size: .75em; line-height: 1.1"
                                                                data-trim
                                                                data-line-numbers="|5,16,18|7-12,27">
                    spring.security:
                      oauth2:
                        authorizationserver:
                          client:
                            frontend:
                              registration:
                                client-id: ${app.security.frontend.client-id}
                                client-secret: "{noop}${app.security.frontend.client-secret}"
                                client-authentication-methods:
                                  - client_secret_post
                                authorization-grant-types:
                                  - authorization_code
                                  - refresh_token
                                  - password
                                redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                post-logout-redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                scopes:
                                  - openid
                                  - profile
                                  - email
                                  - offline_access
                              token:
                                access-token-time-to-live: P6D
                                refresh-token-time-to-live: P6D
                              require-proof-key: true
                </code></pre>
                <aside class="notes">
                    Uwaga, trzeba dodaƒá wszystko, bo klient walidowany - chcieli≈õmy lokalnie inny URL i nie posz≈Ço w
                    application-local, bo nie by≈Ço reszty
                </aside>
            </section>
            <section data-auto-animate>
                <pre data-id="auth-s" style="width: 100%"><code class="yaml r-stretch"
                                                                style="font-size: .75em; line-height: 1.1"
                                                                data-trim
                                                                data-line-numbers>
                    spring.security:
                      oauth2:
                        authorizationserver:
                          # how external apps connect this
                          client:
                            frontend:
                              registration:
                                client-id: ${app.security.frontend.client-id}
                                client-secret: "{noop}${app.security.frontend.client-secret}"
                                client-authentication-methods:
                                  - client_secret_post
                                authorization-grant-types:
                                  - authorization_code
                                  - refresh_token
                                  - password
                                redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                post-logout-redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                scopes:
                                  - openid
                                  - profile
                                  - email
                                  - offline_access
                              token:
                                access-token-time-to-live: P6D
                                refresh-token-time-to-live: P6D
                              require-proof-key: true
                </code></pre>
            </section>
            <section data-auto-animate>
                <div style="font-size: .75em; line-height: 1.1;">
                <pre data-id="flow-change" style="width: 71%;overflow: hidden;">
 +----------+
 | Resource |
 |   Owner  |
 +----------+
       ^
       |
       |
 +-----|----+          Client Identifier      +---------------+
 | .---+---------(1)-- & Redirect URI ------->|               |
 | |   |    |                                 |               |
 | |   '---------(2)-- User authenticates --->|               |
 | | User-  |                                 | Authorization |
 | | Agent  |                                 |     Server    |
 | |        |                                 |               |
 | |    .--------(3)-- Authorization Code ---<|               |
 +-|----|---+                                 +---------------+
   |    |                                         ^      v
   |    |                                         |      |
   ^    v                                         |      |
 +---------+                                      |      |
 |         |>---(4)-- Authorization Code ---------'      |
 |  Client |          & Redirect URI                     |
 |         |                                             |
 |         |<---(5)----- Access Token -------------------'
 +---------+       (w/ Optional Refresh Token)
                    </code></pre>
                </div>
            </section>
            <section data-auto-animate>
                <div style="font-size: .75em; line-height: 1.1;">
                <pre data-id="flow-change" style="width: 96%;overflow: hidden;">
 +----------+
 | Resource |
 |   Owner  |
 +----------+
       ^
       |
       |
 +-----|----+          Client Identifier      +---------------+
 | .---+---------(1)-- & Redirect URI ------->|               |
 | |   |    |                                 |               |
 | |   '---------(2)-- User authenticates --->|               |
 | | User-  |                                 | Authorization |
 | | Agent  |                                 |     Server    |
 | |        |                                 |               |
 | |    .--------(3)-- Authorization Code ---<|               |
 +-|----|---+                                 +---------------+
   |    |                                         ^      v
   |    |                                         |      |
   ^    v                                         |      |
 +---------+                                      |      |
 |         |>---(4)-- Authorization Code ---------'      |
 |  Client |          & Redirect URI                     |
 |         |                                             |
 |         |<---(5)----- Access Token -------------------'
 +---------+       (w/ Optional Refresh Token)
                    </code></pre>
                </div>
            </section>
            <section data-auto-animate>
                <div style="font-size: .75em; line-height: 1.1">
                <pre data-id="flow-change" style="width: 96%;">
 +----------+                                                        +---------------+
 | Resource |                                                        |               |
 |   Owner  |                                                        |               |
 +----------+                                  .-(2.5)- OAuth flow ->|      Okta     |
       ^                                       |                     | Authorization |
       |                                       |                     |     Server    |
       |                                       ^                     |               |
 +-----|----+          Client Identifier      +---------------+      |               |
 | .---+---------(1)-- & Redirect URI ------->|               |      +---------------+
 | |   |    |                                 |               |                    v
 | |   '---------(2)-- User authenticates --->|               |                    |
 | | User-  |                                 | Authorization |                    |
 | | Agent  |                                 |     Server    |<-(2¬æ)- OAuth flow -'
 | |        |                                 |               |
 | |    .--------(3)-- Authorization Code ---<|               |
 +-|----|---+                                 +---------------+
   |    |                                         ^      v
   |    |                                         |      |
   ^    v                                         |      |
 +---------+                                      |      |
 |         |>---(4)-- Authorization Code ---------'      |
 |  Client |          & Redirect URI                     |
 |         |                                             |
 |         |<---(5)----- Access Token -------------------'
 +---------+       (w/ Optional Refresh Token)
                    </code></pre>
                </div>
            </section>
            <section data-auto-animate>
                <div data-id="yaml-client-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html">
                        OAuth Client
                    </a>
                </div>
                <pre style="width: 100%" data-id="yaml-client"><code class="yaml r-stretch"
                                                                     style="font-size: .75em; line-height: 1.1"
                                                                     data-trim
                                                                     data-line-numbers>
                    spring.security:
                      oauth2:
                        authorizationserver:
                          # how external apps connect this
                          client:
                            frontend:
                              registration:
                                client-id: ${app.security.frontend.client-id}
                                client-secret: "{noop}${app.security.frontend.client-secret}"
                                client-authentication-methods:
                                  - client_secret_post
                                authorization-grant-types:
                                  - authorization_code
                                  - refresh_token
                                  - password
                                redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                post-logout-redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                scopes:
                                  - openid
                                  - profile
                                  - email
                                  - offline_access
                              token:
                                access-token-time-to-live: P6D
                                refresh-token-time-to-live: P6D
                              require-proof-key: true
                </code></pre>
            </section>
            <section data-background-image data-auto-animate>
                <div data-id="yaml-client-h">
                    <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html">
                        OAuth Client
                    </a>
                </div>
                <pre style="width: 100%" class="r-stretch" data-id="yaml-client"><code class="yaml"
                                                                                       style="font-size: .75em; line-height: 1.1"
                                                                                       data-trim
                                                                                       data-line-numbers="1-21">
                    spring.security:
                      oauth2:
                        # how this connects Okta
                        client:
                          registration:
                            okta:
                              provider: okta
                              client-id: ${app.security.okta.client-id}
                              client-secret: ${app.security.okta.client-secret}
                              scope:
                                - openid
                                - profile
                                - email
                                - offline_access
                          provider:
                            okta:
                              authorization-uri: ${okta.oauth2.issuer}/v1/authorize
                              token-uri: ${okta.oauth2.issuer}/v1/token
                              user-info-uri: ${okta.oauth2.issuer}/v1/userinfo
                              jwk-set-uri: ${okta.oauth2.issuer}/v1/keys
                              user-name-attribute: sub
                        authorizationserver:
                          # how external apps connect this
                          client:
                            frontend:
                              registration:
                                client-id: ${app.security.frontend.client-id}
                                client-secret: "{noop}${app.security.frontend.client-secret}"
                                client-authentication-methods:
                                  - client_secret_post
                                authorization-grant-types:
                                  - authorization_code
                                  - refresh_token
                                  - password
                                redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                post-logout-redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                scopes:
                                  - openid
                                  - profile
                                  - email
                                  - offline_access
                              token:
                                access-token-time-to-live: P6D
                                refresh-token-time-to-live: P6D
                              require-proof-key: true
                </code></pre>
                <aside class="notes">
                    <code>"/oauth2/authorization/okta"</code> zawiera≈Ço nazwƒô providera
                    <br>
                    Brakuje mi .well-known tutaj
                </aside>
            </section>
            <section>
                <div>
                    <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/index.html">Resource</a>
                    + <a href="https://docs.spring.io/spring-authorization-server/reference/overview.html">Authorization</a> w&nbsp;jednym
                </div>
                <ul>
                    <li class="fragment">Nieczƒôste
                        (<a href="https://stackoverflow.com/questions/76931541/authorization-and-resource-server-in-same-application-using-spring-security-and">przyk≈Çad</a>,
                        <a href="https://stackoverflow.com/questions/64716820/spring-security-oauth2-login-and-resource-server-in-same-application/64752665#64752665">drugi</a>)
                    </li>
                    <li class="fragment">Mo≈ºe klucz symetryczny?</li>
                    <li class="fragment">≈Åatwo testowaƒá - <code>JwtDecoder</code> i <code>JwtEncoder</code>
                        <ul>
                            <li class="fragment">
                                vs. <a href="https://testcontainers.com/modules/keycloak/">Keycloak Testcontainer</a>
                                lub inne
                            </li>
                        </ul>
                    </li>
                    <li class="fragment">Uwaga na wsp√≥lny kontekst Springa, np. sesje</li>
                </ul>
            </section>
        </section>
        <section data-background-image>
            <section>
                <h3>Swagger (<a href="https://springdoc.org/"><code>springdoc-openapi</code></a>)</h3>
                <pre style="width: 100%" class="fragment"><code data-trim class="java"
                                                                style="font-size: .8em;line-height: 1.1"
                                                                data-line-numbers="1-4,6,9-10,11,16-18">
                    @SecurityScheme(
                        name = "openid-connect",
                        type = SecuritySchemeType.OPENIDCONNECT,
                        openIdConnectUrl = "/api/.well-known/openid-configuration")
                    @SecurityScheme(
                        name = "bearer-jwt",
                        type = SecuritySchemeType.HTTP,
                        description = "Fallback method - paste any access token you obtained",
                        scheme = "bearer",
                        bearerFormat = "JWT")
                    @OpenAPIDefinition(
                        info = @Info(
                            title = "${app.title}",
                            description = "${app.description}",
                            version = "${app.version}"),
                        security = {
                            @SecurityRequirement(name = "openid-connect", scopes = "openid"),
                            @SecurityRequirement(name = "bearer-jwt")})
                    @Configuration(proxyBeanMethods = false)
                    class SecurityOpenAPI {}
                </code></pre>
            </section>
            <section data-background-image data-auto-animate>
                <pre style="width: 100%" class="r-stretch" data-id="yaml-swagger"><code class="yaml"
                                                                                        style="font-size: .75em; line-height: 1.1"
                                                                                        data-trim
                                                                                        data-line-numbers="36,38-40,46">
                    spring.security:
                      oauth2:
                        # how this connects Okta
                        client:
                          registration:
                            okta:
                              provider: okta
                              client-id: ${app.security.okta.client-id}
                              client-secret: ${app.security.okta.client-secret}
                              scope:
                                - openid
                                - profile
                                - email
                                - offline_access
                          provider:
                            okta:
                              authorization-uri: ${okta.oauth2.issuer}/v1/authorize
                              token-uri: ${okta.oauth2.issuer}/v1/token
                              user-info-uri: ${okta.oauth2.issuer}/v1/userinfo
                              jwk-set-uri: ${okta.oauth2.issuer}/v1/keys
                              user-name-attribute: sub
                        authorizationserver:
                          # how external apps connect this
                          client:
                            reco:
                              registration:
                                client-id: ${app.security.reco.client-id}
                                client-secret: "{noop}${app.security.reco.client-secret}"
                                client-authentication-methods:
                                  - client_secret_basic
                                authorization-grant-types:
                                  - client_credentials
                                scopes:
                                  - openid
                                  - offline_access
                            frontend:
                              registration:
                                client-id: ${app.security.frontend.client-id}
                                client-secret: "{noop}${app.security.frontend.client-secret}"
                                client-authentication-methods:
                                  - client_secret_post
                                authorization-grant-types:
                                  - authorization_code
                                  - refresh_token
                                  - password
                                redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                post-logout-redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                scopes:
                                  - openid
                                  - profile
                                  - email
                                  - offline_access
                              token:
                                access-token-time-to-live: P6D
                                refresh-token-time-to-live: P6D
                              require-proof-key: true
                </code></pre>
            </section>
            <section data-background-image data-auto-animate>
                <pre style="width: 100%" class="r-stretch" data-id="yaml-swagger"><code class="yaml"
                                                                                        style="font-size: .75em; line-height: 1.1"
                                                                                        data-trim
                                                                                        data-line-numbers="36,38-41,47,49">
                    spring.security:
                      oauth2:
                        # how this connects Okta
                        client:
                          registration:
                            okta:
                              provider: okta
                              client-id: ${app.security.okta.client-id}
                              client-secret: ${app.security.okta.client-secret}
                              scope:
                                - openid
                                - profile
                                - email
                                - offline_access
                          provider:
                            okta:
                              authorization-uri: ${okta.oauth2.issuer}/v1/authorize
                              token-uri: ${okta.oauth2.issuer}/v1/token
                              user-info-uri: ${okta.oauth2.issuer}/v1/userinfo
                              jwk-set-uri: ${okta.oauth2.issuer}/v1/keys
                              user-name-attribute: sub
                        authorizationserver:
                          # how external apps connect this
                          client:
                            reco:
                              registration:
                                client-id: ${app.security.reco.client-id}
                                client-secret: "{noop}${app.security.reco.client-secret}"
                                client-authentication-methods:
                                  - client_secret_basic
                                authorization-grant-types:
                                  - client_credentials
                                scopes:
                                  - openid
                                  - offline_access
                            frontend:
                              registration:
                                client-id: ${app.security.frontend.client-id}
                                client-secret: "{noop}${app.security.frontend.client-secret}"
                                client-authentication-methods:
                                  - client_secret_basic
                                  - client_secret_post
                                authorization-grant-types:
                                  - authorization_code
                                  - refresh_token
                                  - password
                                redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                  - http://localhost:8080/api/swagger-ui/oauth2-redirect.html
                                post-logout-redirect-uris:
                                  - ${app.frontend.url}/api/auth/callback/backend
                                scopes:
                                  - openid
                                  - profile
                                  - email
                                  - offline_access
                              token:
                                access-token-time-to-live: P6D
                                refresh-token-time-to-live: P6D
                              require-proof-key: true
                </code></pre>
            </section>
            <section data-background-image="img/swagger-login.png" data-background-size="contain"></section>
        </section>
        <section>
            <h3 style="margin: 0" class="fragment">Dziƒôkujƒô!</h3>
            <img src="img/2fa.png" style="width: 40%" class="pure-img">
            <ul>
                <li class="fragment" data-fragment-index="1">
                    <a href="https://mat3e.github.io/trendy">
                        mat3e.github.io/trendy
                    </a>
                </li>
                <li class="fragment" data-fragment-index="2">
                    <a href="https://mat3e.github.io/talks/spring-security/confitura.html">
                        mat3e.github.io/talks/spring-security/confitura
                    </a>
                </li>
            </ul>
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/search/search.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/mermaid/mermaid.min.js"></script>
<script>
    mermaid.initialize({startOnLoad: false, theme: 'dark'});

    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealZoom, RevealSearch, RevealMarkdown, RevealHighlight, RevealNotes]
    });

    document.querySelectorAll('.reveal .slides section:not([data-background-image])').forEach(s => {
        s.setAttribute('data-background-image', 'img/twitter.png');
        s.setAttribute('data-background-size', '240px');
        s.setAttribute('data-background-position', '.5em .5em');
    });
</script>
<script>
    Reveal.on('ready', async event => {
        await handleMermaid(event);
    });
    Reveal.on('slidechanged', async event => {
        await handleMermaid(event);
    });
    Reveal.on('slidetransitionend', async event => {
        await handleMermaid(event);
    });

    async function handleMermaid(event) {
        const nodes = event.currentSlide.querySelectorAll('.mermaid');
        if (nodes?.length > 0) {
            await mermaid.run({nodes, suppressErrors: true});
        }
    }
</script>
</body>
</html>
